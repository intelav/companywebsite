<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Social Science AI (Class 6) | Svaraikyam AI</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Font Awesome for Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
    />
    <style>
      /* Custom styles for the page */
      body {
        font-family: "Inter", sans-serif;
        background-color: #0f172a; /* slate-900 */
        color: #f8fafc; /* slate-50 */
      }
      .content-card {
        background-color: #1e293b; /* slate-800 */
        border: 1px solid #334155; /* slate-700 */
        border-radius: 0.75rem;
        padding: 2rem;
      }
      /* Dropdown styles */
      .dropdown-content {
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
      }
      .group:hover .dropdown-content {
        opacity: 1;
        visibility: visible;
      }
      /* Quiz specific styles */
      .option-btn {
        transition: all 0.2s ease-in-out;
      }
      .option-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }
      .correct {
        background-color: #22c55e !important; /* green-500 */
        color: white !important;
        border-color: #16a34a !important; /* green-600 */
      }
      .incorrect {
        background-color: #ef4444 !important; /* red-500 */
        color: white !important;
        border-color: #dc2626 !important; /* red-600 */
      }
      #loader {
        border: 5px solid #f3f3f3;
        border-top: 5px solid #3b82f6;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body class="antialiased">
    <!-- Header -->
    <header
      class="bg-slate-900/70 backdrop-blur-lg sticky top-0 z-50 border-b border-slate-800"
    >
      <nav
        class="container mx-auto px-6 py-4 flex justify-between items-center"
      >
        <a href="index.html" class="flex items-center space-x-3">
          <img
            src="company_logo.png"
            alt="Svaraikyam AI Logo"
            class="h-10"
            onerror="this.onerror=null; this.src='https://placehold.co/100x40/0f172a/ffffff?text=Logo';"
          />
          <span class="text-2xl font-bold text-white">Svaraikyam AI</span>
        </a>
        <ul class="hidden md:flex items-center space-x-8 text-lg">
          <li>
            <a
              href="index.html"
              class="text-slate-300 hover:text-sky-400 transition-colors"
              >Home</a
            >
          </li>
          <!-- Products Dropdown -->
          <li class="relative group">
            <a
              href="products.html"
              class="text-slate-300 hover:text-sky-400 transition-colors flex items-center"
            >
              Products
              <i class="fas fa-chevron-down text-xs ml-2"></i>
            </a>
            <div
              class="dropdown-content absolute top-full left-1/2 -translate-x-1/2 mt-2 w-64 bg-slate-800 border border-slate-700 rounded-lg shadow-lg z-20"
            >
              <a
                href="smartpurchase-details.html"
                class="block px-4 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors rounded-t-lg"
                >SmartPurchase App</a
              >
              <a
                href="annotation_ui.html"
                class="block px-4 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors"
                >Satellite Image Analysis</a
              >
              <a
                href="math_ai_class_6.html"
                class="block px-4 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors"
                >AI Tutors</a
              >
              <a
                href="social_science_ai_class_6.html"
                class="block px-4 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors rounded-b-lg"
                >Social Science AI (Class 6)</a
              >
            </div>
          </li>
          <!-- Services Dropdown -->
          <li class="relative group">
            <a
              href="services.html"
              class="text-slate-300 hover:text-sky-400 transition-colors flex items-center"
            >
              Services
              <i class="fas fa-chevron-down text-xs ml-2"></i>
            </a>
            <div
              class="dropdown-content absolute top-full left-1/2 -translate-x-1/2 mt-2 w-72 bg-slate-800 border border-slate-700 rounded-lg shadow-lg z-20"
            >
              <a
                href="service-android-ar-vr.html"
                class="block px-4 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors rounded-t-lg"
                >Android App Dev with AR/VR</a
              >
              <a
                href="#"
                class="block px-4 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors"
                >Android App Dev with GenAI</a
              >
              <a
                href="#"
                class="block px-4 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors"
                >LLM Training Optimization</a
              >
              <a
                href="#"
                class="block px-4 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors rounded-b-lg"
                >AI Model Migration</a
              >
            </div>
          </li>
          <!-- Trainings Dropdown -->
          <li class="relative group">
            <a
              href="embedded-ai-trainings.html"
              class="text-slate-300 hover:text-sky-400 transition-colors flex items-center"
            >
              Trainings
              <i class="fas fa-chevron-down text-xs ml-2"></i>
            </a>
            <div
              class="dropdown-content absolute top-full left-1/2 -translate-x-1/2 mt-2 w-72 bg-slate-800 border border-slate-700 rounded-lg shadow-lg z-20"
            >
              <a
                href="embedded-ai-trainings.html"
                class="block px-4 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors rounded-t-lg"
                >Embedded Systems & Edge AI</a
              >
              <a
                href="training-firmware.html"
                class="block px-4 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors"
                >Firmware Development</a
              >
              <a
                href="training-linux-drivers.html"
                class="block px-4 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors"
                >Linux Drivers</a
              >
              <a
                href="training-android-hal.html"
                class="block px-4 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors"
                >Android HAL</a
              >
              <a
                href="training-android-security.html"
                class="block px-4 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors"
                >Android Security</a
              >
              <a
                href="training-android-frameworks.html"
                class="block px-4 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors"
                >Android Frameworks</a
              >
              <a
                href="training-x86.html"
                class="block px-4 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors rounded-b-lg"
                >x86 Training (Intel & AMD)</a
              >
            </div>
          </li>
          <!-- Blogs Dropdown -->
          <li class="relative group">
            <a
              href="blogs.html"
              class="text-slate-300 hover:text-sky-400 transition-colors flex items-center"
            >
              Blogs
              <i class="fas fa-chevron-down text-xs ml-2"></i>
            </a>
            <div
              class="dropdown-content absolute top-full left-1/2 -translate-x-1/2 mt-2 w-72 bg-slate-800 border border-slate-700 rounded-lg shadow-lg z-20"
            >
              <a
                href="blog-embedded-systems-1.html"
                class="block px-4 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors rounded-t-lg"
                >Introduction to Embedded Linux</a
              >
              <a
                href="blog-embedded-systems-2.html"
                class="block px-4 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors"
                >Firmware Updates on Edge Devices</a
              >
              <a
                href="blog-embedded-systems-3.html"
                class="block px-4 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors"
                >Porting an AI Model to x86</a
              >
              <a
                href="blog-ai-skills-engineers.html"
                class="block px-4 py-3 text-slate-300 hover:bg-slate-700 hover:text-white transition-colors rounded-b-lg"
                >AI for Professionals</a
              >
            </div>
          </li>
          <li>
            <a
              href="about-contact.html"
              class="text-slate-300 hover:text-sky-400 transition-colors"
              >About & Contact</a
            >
          </li>
        </ul>
      </nav>
    </header>
    <main class="py-12">
      <div class="container mx-auto">
        <div class="w-full max-w-2xl mx-auto">
          <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8 text-gray-800">
            <h1 class="text-2xl md:text-3xl font-bold text-center mb-2">
              Social Science AI (Class 6)
            </h1>
            <p class="text-center text-gray-500 mb-6">
              Test your knowledge on "India's Cultural Roots"
            </p>
            <div id="quiz-container" class="space-y-6">
              <div
                id="question-area"
                class="text-center p-5 bg-blue-50 border-2 border-blue-200 rounded-lg min-h-[120px] flex items-center justify-center"
              >
                <div id="loader"></div>
                <p
                  id="question-text"
                  class="text-xl font-medium text-gray-700 hidden"
                ></p>
              </div>
              <div
                id="options-grid"
                class="grid grid-cols-1 md:grid-cols-2 gap-4"
              >
                <!-- Options will be dynamically inserted here -->
              </div>
              <div
                id="feedback-area"
                class="text-center text-lg font-medium p-3 rounded-lg hidden"
              ></div>
              <button
                id="next-question-btn"
                class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-300 shadow-md hidden"
              >
                Next Question
              </button>
            </div>
          </div>
          <footer class="text-center mt-4 text-slate-400 text-sm">
            <p>
              Powered by AI. Based on the "India's Cultural Roots" chapter.
            </p>
          </footer>
        </div>
      </div>
    </main>
    <!-- Footer -->
    <footer class="bg-slate-900 border-t border-slate-800">
      <div class="container mx-auto px-6 py-8 text-center text-slate-400">
        <p>&copy; 2025 Svaraikyam AI. All Rights Reserved.</p>
      </div>
    </footer>
    <script>
      // --- DOM Elements ---
      const questionArea = document.getElementById("question-area");
      const questionText = document.getElementById("question-text");
      const optionsGrid = document.getElementById("options-grid");
      const feedbackArea = document.getElementById("feedback-area");
      const nextButton = document.getElementById("next-question-btn");
      const loader = document.getElementById("loader");

      // --- State ---
      let correctAnswer = null;
      let isAnswered = false;
      let nextQuestionData = null; // To store the pre-fetched question

      // --- Pre-generated first question ---
      const initialQuestion = {
        question:
          "The Vedic hymns were transmitted for thousands of years through what method?",
        options: [
          "Written on palm-leaf manuscripts",
          "Recited orally",
          "Carved on stone tablets",
          "Painted on cave walls",
        ],
        answer: "Recited orally",
      };

      // --- Chapter Concepts for AI generation ---
      const concepts = [
        "What are the Vedas?",
        "Main ideas of Vedic culture and society",
        "Key concepts of the Upanishads (e.g., atman, brahman, karma)",
        "The story of Nachiketa",
        "The story of Shvetaketu",
        "Core principles of Buddhism (e.g., ahimsa, attachment, enlightenment)",
        "The Buddha and his teachings",
        "Core principles of Jainism (e.g., anekāntavāda, aparigraha, ahimsa)",
        "The story of the monkey-king from the Jataka tales",
        "The story of Rohineya from a Jain story",
        "The relationship between folk/tribal traditions and main schools of thought",
        "The significance of the banyan tree as a symbol",
      ];

      /**
       * Creates a detailed, robust prompt for the AI model.
       * @param {string} concept - The social science concept for the question.
       * @returns {string} The complete prompt.
       */
      function createPrompt(concept) {
        return `
            Generate a multiple-choice social science quiz question for a 6th-grade student based on the chapter "India's Cultural Roots" focusing on the concept of "${concept}". The answer should be directly from the text of the chapter.

            Follow these steps carefully:
            1. Create a clear and simple question statement.
            2. Determine the single correct answer to the question.
            3. Create three distinct and plausible incorrect options (distractors) that are related to the topic but are factually wrong based on the chapter.
            4. Combine the correct answer and the three distractors into a list of four options.
            5. The options should be short strings (e.g., "True" or "False", or a short phrase).

            Format the output STRICTLY as a JSON object with the keys: "question", "options" (an array of strings), and "answer" (a string).

            Example:
            {
              "question": "What does the Vedic statement 'ekam sat viprā bahudhā vadanti' reflect?",
              "options": ["Belief in many different supreme gods", "The unity of cosmic powers", "The importance of rituals", "The power of Vedic hymns"],
              "answer": "The unity of cosmic powers"
            }
        `;
      }

      // --- Main Functions ---

      /**
       * Fetches the *next* question from the AI model and stores it.
       */
      async function fetchNextQuestion() {
        nextQuestionData = null; // Clear previous pre-fetched data
        const randomConcept =
          concepts[Math.floor(Math.random() * concepts.length)];
        const prompt = createPrompt(randomConcept);

        try {
          const result = await callGemini(prompt);
          nextQuestionData = result; // Store the fetched question
        } catch (error) {
          console.error("Error fetching next question:", error);
        }
      }

      /**
       * Shows the next question, either from pre-fetched data or by fetching a new one.
       */
      async function showNextQuestion() {
        resetUI();

        if (nextQuestionData) {
          // If a question was pre-fetched, display it immediately
          displayQuestion(nextQuestionData);
          // And start fetching the *next* one in the background
          fetchNextQuestion();
        } else {
          // Fallback: if pre-fetching failed or is slow, fetch a new one now
          loader.classList.remove("hidden"); // Show loader while fetching
          try {
            const randomConcept =
              concepts[Math.floor(Math.random() * concepts.length)];
            const prompt = createPrompt(randomConcept);
            const result = await callGemini(prompt);
            displayQuestion(result);
          } catch (error) {
            console.error("Error fetching question:", error);
            questionText.textContent =
              "Failed to load a new question. Please try again.";
            questionText.classList.remove("hidden");
            loader.classList.add("hidden");
          }
        }
      }

      /**
       * Calls the Gemini API with a given prompt.
       */
      async function callGemini(prompt) {
        // Leave the API key empty. The Canvas environment will provide it.
        const apiKey = "";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        const payload = {
          contents: [{ role: "user", parts: [{ text: prompt }] }],
        };

        let attempts = 0;
        const maxAttempts = 5;
        while (attempts < maxAttempts) {
          try {
            const response = await fetch(apiUrl, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            });

            if (!response.ok) {
              if (response.status === 429) { // Too Many Requests
                const delay = Math.pow(2, attempts) * 1000;
                await new Promise(res => setTimeout(res, delay));
                attempts++;
                continue; // Retry
              }
              throw new Error(`API call failed with status: ${response.status}`);
            }

            const result = await response.json();
            
            if (
              result.candidates &&
              result.candidates.length > 0 &&
              result.candidates[0].content &&
              result.candidates[0].content.parts &&
              result.candidates[0].content.parts.length > 0
            ) {
              let textResponse = result.candidates[0].content.parts[0].text;
              
              if (textResponse.startsWith("```json")) {
                textResponse = textResponse.slice(7, -3).trim();
              } else if (textResponse.startsWith("```")) {
                textResponse = textResponse.slice(3, -3).trim();
              }

              return JSON.parse(textResponse);
            } else {
              if (result.promptFeedback && result.promptFeedback.blockReason) {
                throw new Error(
                  `Request blocked due to: ${result.promptFeedback.blockReason}`
                );
              }
              throw new Error("Invalid response structure from API.");
            }
          } catch (e) {
            console.error("Fetch error:", e);
            if (attempts === maxAttempts - 1) throw e; // Last attempt, re-throw error
            const delay = Math.pow(2, attempts) * 1000;
            await new Promise(res => setTimeout(res, delay));
            attempts++;
          }
        }
      }

      /**
       * Displays the question and options on the screen.
       * @param {object} data - The question data from the AI.
       */
      function displayQuestion(data) {
        correctAnswer = data.answer;
        loader.classList.add("hidden");
        questionText.textContent = data.question;
        questionText.classList.remove("hidden");

        const shuffledOptions = data.options.sort(() => Math.random() - 0.5);

        shuffledOptions.forEach((option) => {
          const button = document.createElement("button");
          button.className =
            "option-btn w-full text-left p-4 bg-white border-2 border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 hover:border-blue-400";
          button.textContent = option;
          button.onclick = () => handleOptionClick(button, option);
          optionsGrid.appendChild(button);
        });
      }

      /**
       * Handles the logic when a user clicks an option.
       */
      function handleOptionClick(buttonEl, selectedOption) {
        if (isAnswered) return;
        isAnswered = true;

        const isCorrect = String(selectedOption) === String(correctAnswer);

        feedbackArea.classList.remove("hidden");
        if (isCorrect) {
          buttonEl.classList.add("correct");
          feedbackArea.textContent = "Correct! Well done.";
          feedbackArea.className =
            "text-center text-lg font-medium p-3 rounded-lg text-green-700 bg-green-100";
        } else {
          buttonEl.classList.add("incorrect");
          feedbackArea.textContent = `Not quite. The correct answer is ${correctAnswer}.`;
          feedbackArea.className =
            "text-center text-lg font-medium p-3 rounded-lg text-red-700 bg-red-100";

          const allButtons = optionsGrid.querySelectorAll("button");
          allButtons.forEach((btn) => {
            if (String(btn.textContent) === String(correctAnswer)) {
              btn.classList.add("correct");
            }
          });
        }

        nextButton.classList.remove("hidden");
      }

      /**
       * Resets the UI for the next question.
       */
      function resetUI() {
        loader.classList.remove("hidden");
        questionText.classList.add("hidden");
        questionText.textContent = "";
        optionsGrid.innerHTML = "";
        feedbackArea.classList.add("hidden");
        feedbackArea.textContent = "";
        nextButton.classList.add("hidden");
        isAnswered = false;
      }

      /**
       * Initializes the quiz.
       */
      function startQuiz() {
        resetUI();
        // Display the hardcoded initial question instantly
        displayQuestion(initialQuestion);
        // Start fetching the first AI-generated question in the background
        fetchNextQuestion();
      }

      // --- Event Listeners ---
      nextButton.addEventListener("click", showNextQuestion);

      // --- Initial Load ---
      window.onload = startQuiz;
    </script>
  </body>
</html>
