<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Math AI for Class 6 | Svaraikyam AI</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Font Awesome for Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
    />
    <style>
      /* Custom styles for the page */
      body {
        font-family: "Inter", sans-serif;
        background-color: #0f172a; /* slate-900 */
        color: #f8fafc; /* slate-50 */
      }
      .content-card {
        background-color: #1e293b; /* slate-800 */
        border: 1px solid #334155; /* slate-700 */
        border-radius: 0.75rem;
        padding: 2rem;
      }
      /* Dropdown styles */
      .dropdown-content {
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
      }
      .group:hover .dropdown-content {
        opacity: 1;
        visibility: visible;
      }
      /* Quiz specific styles */
      .option-btn {
        transition: all 0.2s ease-in-out;
      }
      .option-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }
      .correct {
        background-color: #22c55e !important; /* green-500 */
        color: white !important;
        border-color: #16a34a !important; /* green-600 */
      }
      .incorrect {
        background-color: #ef4444 !important; /* red-500 */
        color: white !important;
        border-color: #dc2626 !important; /* red-600 */
      }
      #loader {
        border: 5px solid #f3f3f3;
        border-top: 5px solid #3b82f6;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body class="antialiased">
    <!-- Header -->
    <header
      class="bg-slate-900/70 backdrop-blur-lg sticky top-0 z-50 border-b border-slate-800"
    >
      <nav
        class="container mx-auto px-6 py-4 flex justify-between items-center"
      >
        <a href="index.html" class="flex items-center space-x-3">
          <img
            src="company_logo.png"
            alt="Svaraikyam AI Logo"
            class="h-10"
            onerror="this.onerror=null; this.src='https://placehold.co/100x40/0f172a/ffffff?text=Logo';"
          />
          <span class="text-2xl font-bold text-white">Svaraikyam AI</span>
        </a>
        <ul class="hidden md:flex items-center space-x-8 text-lg">
          <!-- Navigation links -->
        </ul>
      </nav>
    </header>
    <main class="py-12">
      <div class="container mx-auto">
        <div class="w-full max-w-2xl mx-auto">
          <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8 text-gray-800">
            <h1 class="text-2xl md:text-3xl font-bold text-center mb-2">
              Math Patterns Quiz
            </h1>
            <p class="text-center text-gray-500 mb-6">
              AI-Generated Questions for Grade 6
            </p>
            <div id="quiz-container" class="space-y-6">
              <div
                id="question-area"
                class="text-center p-5 bg-blue-50 border-2 border-blue-200 rounded-lg min-h-[120px] flex items-center justify-center"
              >
                <div id="loader"></div>
                <p
                  id="question-text"
                  class="text-xl font-medium text-gray-700 hidden"
                ></p>
              </div>
              <div
                id="options-grid"
                class="grid grid-cols-1 md:grid-cols-2 gap-4"
              >
                <!-- Options will be dynamically inserted here -->
              </div>
              <div
                id="feedback-area"
                class="text-center text-lg font-medium p-3 rounded-lg hidden"
              ></div>
              <button
                id="next-question-btn"
                class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-300 shadow-md hidden"
              >
                Next Question
              </button>
            </div>
          </div>
          <footer class="text-center mt-4 text-slate-400 text-sm">
            <p>Powered by AI. Based on "Patterns in Mathematics" concepts.</p>
          </footer>
        </div>
      </div>
    </main>
    <!-- Footer -->
    <footer class="bg-slate-900 border-t border-slate-800">
      <div class="container mx-auto px-6 py-8 text-center text-slate-400">
        <p>&copy; 2025 Svaraikyam AI. All Rights Reserved.</p>
      </div>
    </footer>
    <script>
      // --- DOM Elements ---
      const questionArea = document.getElementById("question-area");
      const questionText = document.getElementById("question-text");
      const optionsGrid = document.getElementById("options-grid");
      const feedbackArea = document.getElementById("feedback-area");
      const nextButton = document.getElementById("next-question-btn");
      const loader = document.getElementById("loader");

      // --- State ---
      let correctAnswer = null;
      let isAnswered = false;
      let nextQuestionData = null; // To store the pre-fetched question

      // --- OPTIMIZATION: Add a pre-generated first question ---
      const initialQuestion = {
        question:
          "The sequence 1, 4, 9, 16, 25,... represents square numbers. What is the next number in this sequence?",
        options: [36, 30, 49, 35],
        answer: 36,
      };

      // --- Pattern Types for AI generation ---
      const patternTypes = [
        "consecutive odd numbers",
        "consecutive even numbers",
        "triangular numbers (1, 3, 6, 10...)",
        "square numbers (1, 4, 9, 16...)",
        "cube numbers (1, 8, 27, 64...)",
        "powers of 2",
        "VirahÄnka numbers (Fibonacci sequence)",
        "the relationship between adding odd numbers and square numbers",
      ];

      // --- Main Functions ---

      /**
       * Fetches the *next* question from the AI model and stores it.
       */
      async function fetchNextQuestion() {
        nextQuestionData = null; // Clear previous pre-fetched data
        const randomPattern =
          patternTypes[Math.floor(Math.random() * patternTypes.length)];
        const prompt = `
            Generate a multiple-choice math quiz question for a 6th-grade student based on the concept of "${randomPattern}".
            The question should be challenging but solvable.
            Provide a question statement, four options (one correct, three plausible incorrect), and identify the correct answer.
            Format the output as a JSON object with the keys: "question", "options" (an array of numbers or strings), and "answer".
            Ensure the options are distinct. For sequence questions, the question should present the first 4 or 5 terms.
            Example for triangular numbers:
            {
              "question": "The sequence 1, 3, 6, 10, 15,... represents triangular numbers. What is the next number in this sequence?",
              "options": [21, 20, 25, 18],
              "answer": 21
            }
        `;

        try {
          const result = await callGemini(prompt);
          nextQuestionData = result; // Store the fetched question
        } catch (error) {
          console.error("Error fetching next question:", error);
          // If fetching fails, the user can still try again by clicking 'Next'
        }
      }

      /**
       * Shows the next question, either from pre-fetched data or by fetching a new one.
       */
      async function showNextQuestion() {
        resetUI();

        if (nextQuestionData) {
          // If a question was pre-fetched, display it immediately
          displayQuestion(nextQuestionData);
          // And start fetching the *next* one in the background
          fetchNextQuestion();
        } else {
          // Fallback: if pre-fetching failed or is slow, fetch a new one now
          loader.classList.remove("hidden"); // Show loader while fetching
          try {
            const randomPattern =
              patternTypes[Math.floor(Math.random() * patternTypes.length)];
            const prompt = `Generate a multiple-choice math quiz question for a 6th-grade student based on the concept of "${randomPattern}". Format as JSON with keys: "question", "options", "answer".`;
            const result = await callGemini(prompt);
            displayQuestion(result);
          } catch (error) {
            console.error("Error fetching question:", error);
            questionText.textContent =
              "Failed to load a new question. Please check your API key and try again.";
            questionText.classList.remove("hidden");
            loader.classList.add("hidden");
          }
        }
      }

      /**
       * Calls the Gemini API with a given prompt.
       */
      async function callGemini(prompt) {
        // !!! IMPORTANT !!!
        // PASTE YOUR GOOGLE AI STUDIO API KEY HERE
        const apiKey = "AIzaSyC6rNEPO-OuGXIQaPSLpkqBJGmsA2L_-nk";

        if (apiKey === "YOUR_API_KEY_HERE") {
          throw new Error("API key is not set. Please add your API key.");
        }

        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        const payload = {
          contents: [{ role: "user", parts: [{ text: prompt }] }],
        };

        const response = await fetch(apiUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        if (!response.ok) {
          throw new Error(`API call failed with status: ${response.status}`);
        }

        const result = await response.json();

        if (
          result.candidates &&
          result.candidates.length > 0 &&
          result.candidates[0].content &&
          result.candidates[0].content.parts &&
          result.candidates[0].content.parts.length > 0
        ) {
          let textResponse = result.candidates[0].content.parts[0].text;

          if (textResponse.startsWith("```json")) {
            textResponse = textResponse.slice(7, -3).trim();
          } else if (textResponse.startsWith("```")) {
            textResponse = textResponse.slice(3, -3).trim();
          }

          try {
            return JSON.parse(textResponse);
          } catch (e) {
            console.error("Failed to parse JSON from response:", textResponse);
            throw new Error("Could not parse the question data from the AI.");
          }
        } else {
          // Add a check for blocked responses due to safety settings
          if (result.promptFeedback && result.promptFeedback.blockReason) {
            throw new Error(
              `Request blocked due to: ${result.promptFeedback.blockReason}`
            );
          }
          throw new Error("Invalid response structure from API.");
        }
      }

      /**
       * Displays the question and options on the screen.
       * @param {object} data - The question data from the AI.
       */
      function displayQuestion(data) {
        correctAnswer = data.answer;
        loader.classList.add("hidden");
        questionText.textContent = data.question;
        questionText.classList.remove("hidden");

        const shuffledOptions = data.options.sort(() => Math.random() - 0.5);

        shuffledOptions.forEach((option) => {
          const button = document.createElement("button");
          button.className =
            "option-btn w-full text-left p-4 bg-white border-2 border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 hover:border-blue-400";
          button.textContent = option;
          button.onclick = () => handleOptionClick(button, option);
          optionsGrid.appendChild(button);
        });
      }

      /**
       * Handles the logic when a user clicks an option.
       */
      function handleOptionClick(buttonEl, selectedOption) {
        if (isAnswered) return;
        isAnswered = true;

        const isCorrect = String(selectedOption) === String(correctAnswer);

        feedbackArea.classList.remove("hidden");
        if (isCorrect) {
          buttonEl.classList.add("correct");
          feedbackArea.textContent = "Correct! Well done.";
          feedbackArea.className =
            "text-center text-lg font-medium p-3 rounded-lg text-green-700 bg-green-100";
        } else {
          buttonEl.classList.add("incorrect");
          feedbackArea.textContent = `Not quite. The correct answer is ${correctAnswer}.`;
          feedbackArea.className =
            "text-center text-lg font-medium p-3 rounded-lg text-red-700 bg-red-100";

          const allButtons = optionsGrid.querySelectorAll("button");
          allButtons.forEach((btn) => {
            if (String(btn.textContent) === String(correctAnswer)) {
              btn.classList.add("correct");
            }
          });
        }

        nextButton.classList.remove("hidden");
      }

      /**
       * Resets the UI for the next question.
       */
      function resetUI() {
        loader.classList.remove("hidden");
        questionText.classList.add("hidden");
        questionText.textContent = "";
        optionsGrid.innerHTML = "";
        feedbackArea.classList.add("hidden");
        feedbackArea.textContent = "";
        nextButton.classList.add("hidden");
        isAnswered = false;
      }

      /**
       * Initializes the quiz.
       */
      function startQuiz() {
        resetUI();
        // Display the hardcoded initial question instantly
        displayQuestion(initialQuestion);
        // Start fetching the first AI-generated question in the background
        fetchNextQuestion();
      }

      // --- Event Listeners ---
      nextButton.addEventListener("click", showNextQuestion);

      // --- Initial Load ---
      window.onload = startQuiz;
    </script>
  </body>
</html>
